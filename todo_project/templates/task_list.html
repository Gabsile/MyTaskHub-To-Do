{% extends "base.html" %}

{% block title %}{{ page_title|default:"Tasks" }}{% endblock %}

{% block content %}
<div class="task-page">
    <div class="page-header">
        <h1 class="page-title">{{ page_title|default:"Today" }}</h1>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-value">{{ pending_count|default:"0" }}</div>
            <div class="stat-label">Tasks to be Completed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ completed_count|default:"0" }}</div>
            <div class="stat-label">Completed Tasks</div>
        </div>
    </div>

    <!-- Chatbot Button -->
    <button id="chat-btn" class="chatbot-floating-btn" title="Chat Assistant">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" fill="white"/>
            <path d="M12 2C6.48 2 2 6.48 2 12C2 13.54 2.38 15 3.06 16.28L2 22L7.72 20.94C9 21.62 10.46 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C10.74 20 9.53 19.7 8.46 19.16L8.14 18.98L4.42 19.86L5.3 16.14L5.12 15.82C4.58 14.75 4.28 13.54 4.28 12.28C4.28 7.74 7.74 4.28 12.28 4.28C16.82 4.28 20.28 7.74 20.28 12.28C20.28 16.82 16.54 20 12 20ZM16 13.5C15.75 13.38 14.5 12.76 14.26 12.68C14.02 12.6 13.84 12.56 13.66 12.81C13.48 13.06 12.98 13.64 12.82 13.82C12.66 14 12.5 14.02 12.25 13.9C12 13.78 11.16 13.5 10.18 12.62C9.42 11.94 8.92 11.1 8.76 10.85C8.6 10.6 8.74 10.45 8.86 10.33C8.97 10.22 9.1 10.04 9.22 9.88C9.34 9.72 9.38 9.6 9.46 9.42C9.54 9.24 9.5 9.08 9.44 8.96C9.38 8.84 8.92 7.58 8.7 7.08C8.48 6.6 8.26 6.66 8.1 6.66H7.58C7.4 6.66 7.12 6.72 6.88 6.97C6.64 7.22 5.98 7.84 5.98 9.1C5.98 10.36 6.92 11.58 7.04 11.76C7.16 11.94 8.92 14.64 11.58 15.76C12.18 16.02 12.64 16.18 13 16.3C13.6 16.48 14.14 16.46 14.58 16.4C15.06 16.32 16.08 15.78 16.3 15.18C16.52 14.58 16.52 14.06 16.46 13.96C16.4 13.86 16.25 13.62 16 13.5Z" fill="currentColor"/>
        </svg>
    </button>

    <!-- Quick Add Task -->
    <div class="quick-add-container">
        <form method="POST" action="{% url 'quick_add_task' %}" class="quick-add-form" id="quickAddForm">
            {% csrf_token %}
            <input type="hidden" name="filter" value="{{ current_filter }}">
            <a href="{% url 'add_task' %}?filter={{ current_filter }}" class="quick-add-icon" title="Open detailed form">+</a>
            <input 
                type="text" 
                name="title" 
                class="quick-add-input" 
                placeholder="Add a task to &quot;{{ page_title|default:"Tasks" }}&quot;, press [Enter] to save"
                autocomplete="off"
            >
        </form>
    </div>

    <!-- Task List -->
    <div class="tasks-container">
        {% if tasks %}
            {% for task in tasks %}
            <div class="task-item {% if task.completed %}task-completed{% endif %}" data-task-id="{{ task.id }}">
                <div class="task-checkbox-wrapper">
                    <input 
                        type="checkbox" 
                        class="task-checkbox" 
                        id="task-{{ task.id }}" 
                        {% if task.completed %}checked{% endif %}
                        onchange="toggleTaskCompletion('{{ task.id }}', this.checked)"
                    >
                    <label for="task-{{ task.id }}"></label>
                </div>
                <div class="task-content">
                    <div class="task-title">{{ task.title }}</div>
                    <div class="task-meta">
                        {% if task.due_date %}
                            <span class="task-date">ğŸ“… {{ task.due_date|date:"M d" }}</span>
                        {% endif %}
                        {% if task.due_time %}
                            <span class="task-time">â° {{ task.due_time|time:"H:i" }}</span>
                        {% endif %}
                        {% if task.priority %}
                            <span class="task-priority priority-{{ task.priority|lower }}">{{ task.priority }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="task-actions">
                    <a href="{% url 'edit_task' task.id %}?filter={{ current_filter }}" class="task-action-btn" title="Edit">âœï¸</a>
                    <a href="{% url 'delete_task' task.id %}?filter={{ current_filter }}" class="task-action-btn delete-task-btn" title="Delete">ğŸ—‘ï¸</a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-tasks">
                <div class="no-tasks-icon">ğŸ“‹</div>
                <div class="no-tasks-title">No Task</div>
                <div class="no-tasks-message">Click the input box above to add a new task</div>
            </div>
        {% endif %}
        
        {% if has_completed %}
            <button class="show-completed-btn" onclick="toggleCompleted()">
                Show Completed Tasks â–¼
            </button>
        {% endif %}
    </div>
</div>
{% endblock %}